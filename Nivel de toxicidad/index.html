<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test de Toxicidad Laboral ‚Ä¢ Por Soamy Lanza</title>
  <style>
    :root{
      --bg:#071018;
      --card: rgba(16,24,40,.70);
      --card2: rgba(12,18,32,.78);
      --text:#e8eefc;
      --muted:#a9b6d3;
      --border: rgba(255,255,255,.12);
      --accent:#18c07a;
      --warn:#f7b731;
      --danger:#ff5c7a;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 20% -10%, rgba(24,192,122,.22), transparent 55%),
        radial-gradient(900px 650px at 85% 0%, rgba(247,183,49,.18), transparent 55%),
        radial-gradient(900px 650px at 90% 80%, rgba(255,92,122,.12), transparent 55%),
        linear-gradient(180deg, #050b11, var(--bg));
      overflow-x:hidden;
    }
    .wrap{
      max-width: 1100px;
      margin: 28px auto;
      padding: 0 16px 40px;
    }
    .header{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: 22px;
      padding: 18px 18px 16px;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .title{
      display:flex; gap:12px; align-items:flex-start;
    }
    .badge{
      width:42px; height:42px; border-radius:14px;
      display:grid; place-items:center;
      background: rgba(24,192,122,.16);
      border:1px solid rgba(24,192,122,.35);
      box-shadow: 0 8px 25px rgba(0,0,0,.35);
      font-size:22px;
      flex:0 0 auto;
    }
    h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
      line-height:1.25;
    }
    .sub{
      margin-top:4px;
      color:var(--muted);
      font-size: 13.5px;
      line-height:1.35;
    }
    .by{
      margin-top:4px;
      font-weight:600;
      color:#d7e4ff;
      font-size: 13.5px;
    }

    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .inner{ padding: 14px; }
    .card .inner.pad2{ padding: 16px; }

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .pillrow{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
    }
    .pill{
      display:flex; gap:8px; align-items:center;
      padding: 10px 12px;
      background: rgba(0,0,0,.18);
      border:1px solid var(--border);
      border-radius: 999px;
      font-size: 13px;
      color: #dbe7ff;
      white-space:nowrap;
    }
    .pill strong{font-weight:800}
    .btnrow{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end}
    button, .btn{
      cursor:pointer;
      border-radius: 14px;
      border:1px solid var(--border);
      padding: 11px 14px;
      font-weight:700;
      color: var(--text);
      background: rgba(0,0,0,.18);
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    button:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.22)}
    .btn.primary{
      background: rgba(24,192,122,.18);
      border-color: rgba(24,192,122,.38);
    }
    .btn.warn{
      background: rgba(247,183,49,.14);
      border-color: rgba(247,183,49,.35);
    }
    .btn.danger{
      background: rgba(255,92,122,.12);
      border-color: rgba(255,92,122,.35);
    }

    .panel{
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
    }
    .panel h3{
      margin:0 0 8px;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .panel p, .panel li{
      margin:0;
      color: var(--muted);
      font-size: 13.5px;
      line-height: 1.45;
    }
    .panel ul{margin:8px 0 0 18px; padding:0}
    .panel li{margin:4px 0}

    .scaleBox{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .scaleLegend{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      color: var(--muted);
      font-size: 13px;
      line-height:1.25;
    }
    .scaleLegend span{
      border:1px solid var(--border);
      background: rgba(0,0,0,.15);
      border-radius: 999px;
      padding: 7px 10px;
      white-space:nowrap;
    }

    .items{
      display:grid;
      gap:10px;
      margin-top: 10px;
    }
    .item{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
    }
    .itemTop{
      display:flex;
      gap:10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .q{
      margin:0;
      font-size: 14px;
      line-height:1.35;
      color:#e9f0ff;
    }
    .tagR{
      flex:0 0 auto;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(24,192,122,.35);
      background: rgba(24,192,122,.12);
      color:#c9ffe9;
    }
    .opts{
      margin-top:10px;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:8px;
    }
    @media (max-width: 560px){
      .opts{grid-template-columns: repeat(5, minmax(0,1fr));}
      .item{padding: 11px;}
      .q{font-size: 13.5px;}
    }
    .opt{
      position:relative;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 10px 6px;
      text-align:center;
      font-weight:800;
      color:#e9f0ff;
      cursor:pointer;
      transition: transform .06s ease, border-color .2s ease, background .2s ease;
      user-select:none;
    }
    .opt:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.20); }
    .opt input{ position:absolute; inset:0; opacity:0; cursor:pointer; }
    .opt[data-checked="true"]{
      background: rgba(24,192,122,.18);
      border-color: rgba(24,192,122,.45);
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }

    .rightCol{
      display:grid;
      gap:16px;
      position:sticky;
      top:14px;
    }
    @media (max-width: 980px){
      .rightCol{position:static}
    }

    .resultBox{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 14px;
      display:grid;
      gap:12px;
    }
    .scoreLine{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .big{
      font-size: 26px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .level{
      font-weight:900;
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      white-space:nowrap;
    }
    .meter{
      height: 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(24,192,122,.95), rgba(247,183,49,.95), rgba(255,92,122,.95));
      transition: width .35s ease;
    }
    .muted{color:var(--muted); font-size: 13.5px; line-height:1.45;}
    .sectionTitle{
      margin: 0 0 6px;
      font-size: 14px;
      font-weight: 900;
      letter-spacing:.2px;
    }
    .divider{
      height:1px; background: rgba(255,255,255,.10);
      margin: 6px 0;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(16,24,40,.92);
      border: 1px solid rgba(255,255,255,.14);
      color: #eaf1ff;
      box-shadow: 0 20px 70px rgba(0,0,0,.55);
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 13px;
      display:none;
      gap:8px;
      align-items:center;
      z-index: 50;
    }
    .toast.show{display:flex}
    .tiny{
      font-size: 12px;
      color: rgba(233,240,255,.75);
      margin-top: 8px;
    }
    a{color:#bde7ff}
    .foot{
      margin-top: 12px;
      color: rgba(233,240,255,.70);
      font-size: 12px;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <div class="badge">üß™</div>
        <div>
          <h1>Nivel de Toxicidad Laboral</h1>
          <div class="sub">
            Responde seg√∫n tu experiencia en los √∫ltimos <strong>30 d√≠as</strong>. Escala Likert (1 a 5).
          </div>
          <div class="by">Por: Soamy Lanza</div>
        </div>
      </div>
      <div class="pillrow">
        <div class="pill">‚è±Ô∏è <span>Tiempo:</span> <strong id="time">00:00</strong></div>
        <div class="pill">üìã <span>Respondidas:</span> <strong id="answered">0</strong>/20</div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: Form -->
      <div class="card">
        <div class="inner pad2">
          <div class="toolbar">
            <div class="pillrow">
              <div class="pill">Instrucciones</div>
            </div>
            <div class="btnrow">
              <button class="btn primary" id="calcBtn">Calcular</button>
              <button class="btn warn" id="resetBtn" title="Borra respuestas y reinicia">Reiniciar</button>
              <button class="btn" id="shareBtn">Compartir</button>
            </div>
          </div>

          <div class="panel">
            <h3>Escala Likert (1 a 5)</h3>
            <div class="scaleLegend">
              <span><strong>1</strong> = Totalmente en desacuerdo</span>
              <span><strong>2</strong> = En desacuerdo</span>
              <span><strong>3</strong> = Ni de acuerdo ni en desacuerdo</span>
              <span><strong>4</strong> = De acuerdo</span>
              <span><strong>5</strong> = Totalmente de acuerdo</span>
            </div>
            <div class="tiny">
              (R) = √≠tem invertido (positivo): se invierte autom√°ticamente al calcular.
            </div>
          </div>

          <div class="items" id="items"></div>

          <div class="foot">
            Nota: herramienta de autodiagn√≥stico. √ösala con confidencialidad y enfoque preventivo.
          </div>
        </div>
      </div>

      <!-- RIGHT: Results -->
      <div class="rightCol">
        <div class="card">
          <div class="inner pad2">
            <div class="resultBox">
              <div class="scoreLine">
                <div>
                  <div class="muted">Puntaje total</div>
                  <div class="big"><span id="score">‚Äî</span> <span class="muted">/ 100</span></div>
                </div>
                <div class="level" id="levelTag">Nivel: ‚Äî</div>
              </div>
              <div class="meter" aria-label="barra de progreso">
                <div class="bar" id="bar"></div>
              </div>
              <div class="muted" id="resultHint">
                Completa el cuestionario y presiona <strong>Calcular</strong> para ver tu resultado.
              </div>

              <div class="divider"></div>

              <div>
                <div class="sectionTitle">Resultados</div>
                <div class="muted" id="resultsText">‚Äî</div>
              </div>

              <div>
                <div class="sectionTitle">Conclusiones</div>
                <div class="muted" id="conclusionsText">‚Äî</div>
              </div>

              <div>
                <div class="sectionTitle">Recomendaciones / Plan de mejora</div>
                <div class="muted" id="recommendationsText">‚Äî</div>
              </div>

              <div class="tiny">
                Tip: si es <strong>alto</strong> o <strong>muy alto</strong>, considera apoyo profesional y canales formales de intervenci√≥n.
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="inner pad2">
            <div class="panel">
              <h3>Puntuaci√≥n</h3>
              <p><strong>Rango total:</strong> 20 a 100 (sumando 20 √≠tems)</p>
              <ul>
                <li><strong>20‚Äì39:</strong> Bajo nivel de toxicidad</li>
                <li><strong>40‚Äì59:</strong> Moderado (alerta)</li>
                <li><strong>60‚Äì79:</strong> Alto (riesgo)</li>
                <li><strong>80‚Äì100:</strong> Muy alto (urgente)</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="toast" id="toast">‚úÖ <span id="toastTxt"></span></div>

  <script>
    // --- Data ---
    const ITEMS = [
      { id: 1,  text: "En mi equipo se trata a las personas con respeto, incluso bajo presi√≥n.", reversed: true },
      { id: 2,  text: "He presenciado comentarios humillantes, burlas o sarcasmo hiriente en el trabajo.", reversed: false },
      { id: 3,  text: "Me siento seguro/a de expresar ideas sin miedo a ridiculizaci√≥n o castigo.", reversed: true },
      { id: 4,  text: "Los conflictos se manejan con di√°logo y soluciones, no con ataques personales.", reversed: true },

      { id: 5,  text: "Las decisiones del liderazgo se sienten justas y coherentes.", reversed: true },
      { id: 6,  text: "He visto favoritismos que afectan tareas, oportunidades o reconocimientos.", reversed: false },
      { id: 7,  text: "Mi jefe/a da retroalimentaci√≥n de forma profesional y constructiva.", reversed: true },
      { id: 8,  text: "Se usan amenazas, presi√≥n excesiva o miedo para ‚Äúmotivar‚Äù resultados.", reversed: false },

      { id: 9,  text: "La informaci√≥n importante se comunica a tiempo y con claridad.", reversed: true },
      { id: 10, text: "Se ocultan datos o se ‚Äújuega pol√≠tica‚Äù para dejar mal a otros.", reversed: false },
      { id: 11, text: "Siento que puedo pedir ayuda sin que lo usen en mi contra.", reversed: true },
      { id: 12, text: "Los rumores y chismes afectan el ambiente de trabajo.", reversed: false },

      { id: 13, text: "La carga laboral es razonable y se respeta el tiempo personal.", reversed: true },
      { id: 14, text: "Se espera que trabaje fuera de horario como algo normal o obligatorio.", reversed: false },
      { id: 15, text: "Puedo tomar descansos y permisos sin sentir culpa o represalias.", reversed: true },
      { id: 16, text: "El estr√©s y la urgencia son tan constantes que ya se sienten ‚Äúnormales‚Äù.", reversed: false },

      { id: 17, text: "Este trabajo impacta negativamente mi salud mental o emocional.", reversed: false },
      { id: 18, text: "Me siento valorado/a y reconocido/a por mi aporte.", reversed: true },
      { id: 19, text: "He pensado en renunciar principalmente por el ambiente, no por el trabajo en s√≠.", reversed: false },
      { id: 20, text: "Las personas suelen culparse entre s√≠ en vez de asumir responsabilidades compartidas.", reversed: false },
    ];

    const STORAGE_KEY = "toxicidad_laboral_v1";
    const timeEl = document.getElementById("time");
    const answeredEl = document.getElementById("answered");
    const itemsEl = document.getElementById("items");

    const scoreEl = document.getElementById("score");
    const levelTagEl = document.getElementById("levelTag");
    const barEl = document.getElementById("bar");
    const resultHintEl = document.getElementById("resultHint");

    const resultsTextEl = document.getElementById("resultsText");
    const conclusionsTextEl = document.getElementById("conclusionsText");
    const recommendationsTextEl = document.getElementById("recommendationsText");

    const calcBtn = document.getElementById("calcBtn");
    const resetBtn = document.getElementById("resetBtn");
    const shareBtn = document.getElementById("shareBtn");

    const toast = document.getElementById("toast");
    const toastTxt = document.getElementById("toastTxt");

    // --- Timer ---
    let startTs = null;
    let timerId = null;

    function fmtTime(totalSeconds){
      const m = Math.floor(totalSeconds / 60);
      const s = Math.floor(totalSeconds % 60);
      return String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
    }
    function tick(){
      if(!startTs) return;
      const sec = (Date.now() - startTs) / 1000;
      timeEl.textContent = fmtTime(sec);
    }
    function startTimerIfNeeded(){
      if(startTs) return;
      startTs = Date.now();
      timerId = setInterval(tick, 250);
      tick();
      saveState();
    }
    function resetTimer(){
      startTs = null;
      if(timerId) clearInterval(timerId);
      timerId = null;
      timeEl.textContent = "00:00";
    }

    // --- UI helpers ---
    function showToast(msg){
      toastTxt.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 2200);
    }

    function getState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : null;
      }catch{ return null; }
    }
    function saveState(){
      const answers = {};
      ITEMS.forEach(it=>{
        const v = getSelectedValue(it.id);
        if(v) answers[it.id] = v;
      });
      const st = { answers, startTs };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(st));
      updateAnswered();
    }
    function clearState(){
      localStorage.removeItem(STORAGE_KEY);
    }

    function getSelectedValue(itemId){
      const r = document.querySelector(`input[name="q${itemId}"]:checked`);
      return r ? Number(r.value) : 0;
    }

    function updateAnswered(){
      let count = 0;
      ITEMS.forEach(it => { if(getSelectedValue(it.id)) count++; });
      answeredEl.textContent = count;
    }

    // --- Render questionnaire ---
    function render(){
      itemsEl.innerHTML = "";
      ITEMS.forEach(it=>{
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="itemTop">
            <p class="q"><strong>${it.id})</strong> ${escapeHtml(it.text)}</p>
            ${it.reversed ? `<span class="tagR">(R)</span>` : ``}
          </div>
          <div class="opts" role="radiogroup" aria-label="Respuesta ${it.id}">
            ${[1,2,3,4,5].map(v=>`
              <label class="opt" data-v="${v}" data-checked="false">
                <input type="radio" name="q${it.id}" value="${v}" aria-label="${v}">
                ${v}
              </label>
            `).join("")}
          </div>
        `;
        itemsEl.appendChild(div);

        // Event binding for highlighting
        const opts = div.querySelectorAll(".opt");
        opts.forEach(opt=>{
          const input = opt.querySelector("input");
          input.addEventListener("change", ()=>{
            startTimerIfNeeded();
            opts.forEach(o=>o.dataset.checked="false");
            opt.dataset.checked="true";
            saveState();
          });
        });
      });

      // Load saved answers
      const st = getState();
      if(st?.answers){
        ITEMS.forEach(it=>{
          const val = st.answers[it.id];
          if(val){
            const input = document.querySelector(`input[name="q${it.id}"][value="${val}"]`);
            if(input){
              input.checked = true;
              const label = input.closest(".opt");
              const group = input.closest(".opts").querySelectorAll(".opt");
              group.forEach(o=>o.dataset.checked="false");
              label.dataset.checked="true";
            }
          }
        });
      }
      if(st?.startTs){
        startTs = st.startTs;
        timerId = setInterval(tick, 250);
        tick();
      }
      updateAnswered();
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // --- Scoring ---
    function invertLikert(v){
      // 1<->5, 2<->4, 3<->3
      return 6 - v;
    }

    function compute(){
      let sum = 0;
      let answered = 0;

      for(const it of ITEMS){
        const v = getSelectedValue(it.id);
        if(!v) continue;
        answered++;
        sum += it.reversed ? invertLikert(v) : v;
      }

      if(answered < ITEMS.length){
        showToast(`Te faltan ${ITEMS.length - answered} preguntas por responder.`);
        return null;
      }

      // sum range: 20..100
      const score = sum;
      return score;
    }

    function classify(score){
      if(score <= 39) return "Bajo";
      if(score <= 59) return "Moderado";
      if(score <= 79) return "Alto";
      return "Muy alto";
    }

    function getTexts(score){
      const nivel = classify(score);

      const resultados =
        `Tu puntaje total es ${score}/100. Este resultado refleja tu experiencia percibida en los √∫ltimos 30 d√≠as ` +
        `en aspectos como respeto, liderazgo, comunicaci√≥n, carga laboral, l√≠mites y bienestar.`;

      let conclusiones = "";
      let recomendaciones = "";

      if(nivel === "Bajo"){
        conclusiones =
          "El entorno se percibe mayormente saludable. Es probable que existan pr√°cticas de respeto y comunicaci√≥n funcionales. " +
          "Aun as√≠, conviene sostener h√°bitos positivos para evitar deterioro por presi√≥n o cambios.";
        recomendaciones =
          "‚Ä¢ Mantener buenas pr√°cticas (respeto, acuerdos, feedback).<br>" +
          "‚Ä¢ Reforzar reconocimiento y comunicaci√≥n frecuente.<br>" +
          "‚Ä¢ Medici√≥n peri√≥dica (mensual/trimestral) para detectar se√±ales tempranas.<br>" +
          "‚Ä¢ Promover pausas, l√≠mites sanos y claridad de roles.";
      } else if(nivel === "Moderado"){
        conclusiones =
          "Se observan se√±ales de tensi√≥n o pr√°cticas que podr√≠an deteriorar el clima si no se atienden. " +
          "La organizaci√≥n est√° en zona de alerta: todav√≠a es manejable con ajustes concretos.";
        recomendaciones =
          "‚Ä¢ Revisar pr√°cticas de liderazgo (coherencia, justicia, feedback).<br>" +
          "‚Ä¢ Establecer canales seguros para reportar conflictos y pedir ayuda.<br>" +
          "‚Ä¢ Alinear prioridades y ajustar cargas/expectativas realistas.<br>" +
          "‚Ä¢ Capacitar en manejo de conflicto y comunicaci√≥n respetuosa.<br>" +
          "‚Ä¢ Definir reglas claras contra burlas, chismes y ataques personales.";
      } else if(nivel === "Alto"){
        conclusiones =
          "El ambiente presenta din√°micas da√±inas frecuentes que afectan el bienestar y el desempe√±o. " +
          "Existe riesgo elevado de rotaci√≥n, conflictos y desgaste emocional si no se interviene.";
        recomendaciones =
          "‚Ä¢ Intervenci√≥n prioritaria con plan formal (30‚Äì60 d√≠as) y responsables definidos.<br>" +
          "‚Ä¢ Diagn√≥stico profundo (entrevistas, focus groups, mapa de riesgos).<br>" +
          "‚Ä¢ Acciones correctivas sobre liderazgo y pr√°cticas de presi√≥n/miedo.<br>" +
          "‚Ä¢ Revisi√≥n de roles, cargas, horarios y respeto de l√≠mites.<br>" +
          "‚Ä¢ Acompa√±amiento (coaching/psicolog√≠a organizacional) y seguimiento semanal.";
      } else {
        conclusiones =
          "El entorno se percibe claramente perjudicial y representa un riesgo serio para la salud mental y la permanencia. " +
          "Se recomienda actuar con urgencia y priorizar medidas de protecci√≥n y contenci√≥n.";
        recomendaciones =
          "‚Ä¢ Acci√≥n inmediata: intervenci√≥n psicosocial y plan de contenci√≥n.<br>" +
          "‚Ä¢ Evaluaci√≥n externa / auditor√≠a de clima para objetividad.<br>" +
          "‚Ä¢ Canales confidenciales y protecci√≥n activa contra represalias.<br>" +
          "‚Ä¢ Medidas urgentes: freno a amenazas, humillaciones y sobrecarga.<br>" +
          "‚Ä¢ Seguimiento directivo con indicadores (rotaci√≥n, ausentismo, incidentes, clima).";
      }

      return { nivel, resultados, conclusiones, recomendaciones };
    }

    function renderResults(score){
      const { nivel, resultados, conclusiones, recomendaciones } = getTexts(score);

      scoreEl.textContent = String(score);
      levelTagEl.textContent = `Nivel: ${nivel}`;

      // bar 20..100 mapped to 0..100
      const pct = Math.max(0, Math.min(100, ((score - 20) / 80) * 100));
      barEl.style.width = pct.toFixed(1) + "%";

      resultHintEl.innerHTML = `Interpretaci√≥n autom√°tica: <strong>${nivel}</strong>.`;
      resultsTextEl.textContent = resultados;
      conclusionsTextEl.textContent = conclusiones;
      recommendationsTextEl.innerHTML = recomendaciones;

      showToast("Resultado calculado ‚úÖ");
    }

    // --- Actions ---
    calcBtn.addEventListener("click", ()=>{
      const score = compute();
      if(score == null) return;
      renderResults(score);
    });

    resetBtn.addEventListener("click", ()=>{
      if(!confirm("¬øReiniciar? Se borrar√°n tus respuestas.")) return;
      clearState();
      resetTimer();
      render();
      scoreEl.textContent = "‚Äî";
      levelTagEl.textContent = "Nivel: ‚Äî";
      barEl.style.width = "0%";
      resultHintEl.innerHTML = "Completa el cuestionario y presiona <strong>Calcular</strong> para ver tu resultado.";
      resultsTextEl.textContent = "‚Äî";
      conclusionsTextEl.textContent = "‚Äî";
      recommendationsTextEl.textContent = "‚Äî";
      showToast("Reiniciado.");
    });

    async function share(){
      const url = location.href;
      const text =
        "Nivel de Toxicidad Laboral ‚Ä¢ Por Soamy Lanza\n" +
        "Responde 20 √≠tems (1‚Äì5) y obt√©n tu nivel con resultados y recomendaciones.\n\n" +
        url;

      // Prefer Web Share API
      try{
        if(navigator.share){
          await navigator.share({ title: document.title, text, url });
          return;
        }
      }catch{}

      // Clipboard fallback
      try{
        await navigator.clipboard.writeText(url);
        showToast("Link copiado ‚úÖ");
      }catch{
        prompt("Copia este link:", url);
      }
    }
    shareBtn.addEventListener("click", share);

    // Auto-save on unload
    window.addEventListener("beforeunload", saveState);

    // Init
    render();
  </script>
</body>
</html>
