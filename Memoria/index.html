<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Memoria ‚Ä¢ Por Soamy Lanza</title>
  <style>
    :root{
      --bg:#0b0f14;
      --line:#233049;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --good:#22c55e;
      --warn:#f59e0b;
      --shadow: 0 14px 40px rgba(0,0,0,.45);
      --r: 18px;

      /* JS los ajusta */
      --boardSize: 380px;
      --gap: 10px;
      --pad: 12px;

      --cardRadius: 16px;
      --cardFont: 26px;
      --backFont: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(900px 500px at 18% 12%, rgba(34,197,94,.14), transparent 55%),
                  radial-gradient(900px 500px at 85% 12%, rgba(245,158,11,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      overflow:hidden; /* sin scroll */
    }

    .app{
      height:100svh;
      max-width:1100px;
      margin:0 auto;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }

    header{
      background: rgba(18,24,38,.92);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:12px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex:0 0 auto;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:260px;
    }
    .title h1{
      margin:0;
      font-size:18px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .title small{color:var(--muted)}
    .byline{color:var(--muted); font-size:12px; margin-top:2px;}

    /* üîΩ Header ahora solo muestra el t√≠tulo (sin m√©tricas) */
    .statsTop{ display:none; }

    main{ flex:1 1 auto; min-height:0; }

    .panel{
      height:100%;
      background: rgba(18,24,38,.92);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }

    /* Layout: izquierda / derecha */
    .layout{
      flex:1 1 auto;
      min-height:0;
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:12px;
      align-items:start; /* tablero arriba */
    }

    .side{
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .cardBox{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(11,15,20,.35);
      padding:10px;
    }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:flex-start;
    }

    select,button{
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(11,15,20,.35);
      color: var(--text);
      padding:10px 12px;
      font-size:14px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button.primary{
      border-color: rgba(34,197,94,.45);
      background: rgba(34,197,94,.14);
    }
    button.warn{
      border-color: rgba(245,158,11,.45);
      background: rgba(245,158,11,.14);
    }

    .hint{
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }

    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }

    .shareBig{
      width:100%;
      justify-content:center;
      font-weight:600;
    }

    /* ‚úÖ NUEVO: m√©tricas en la izquierda (abajo) */
    .statsLeft{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }
    .pill{
      border:1px solid var(--line);
      border-radius:14px;
      padding:9px 10px;
      background: rgba(11,15,20,.35);
      font-size:13px;
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
    }
    .pill b{font-variant-numeric: tabular-nums;}

    /* tablero arriba y centrado */
    .boardArea{
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      justify-content:flex-start; /* arriba */
    }

    .boardWrap{
      flex:0 0 auto;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      overflow:hidden;
      width:100%;
      padding-top:0; /* üîº pegado arriba */
    }

    .board{
      display:grid;
      gap: var(--gap);
      width: var(--boardSize);
      height: var(--boardSize);
      padding: var(--pad);
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(11,15,20,.35);
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
    }

    .cardBtn{
      position:relative;
      border-radius: var(--cardRadius);
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: var(--cardFont);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      outline:none;
      user-select:none;
    }
    .cardBtn:active{ transform: scale(.98); }
    .cardBtn.revealed{
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.14);
    }
    .cardBtn.matched{
      background: rgba(34,197,94,.16);
      border-color: rgba(34,197,94,.35);
      cursor:default;
    }
    .face{
      opacity:0;
      transform: scale(.7);
      transition: opacity .12s ease, transform .12s ease;
    }
    .cardBtn.revealed .face,
    .cardBtn.matched .face{
      opacity:1;
      transform: scale(1);
    }
    .backMark{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:.85;
      transition: opacity .12s ease;
      font-size: var(--backFont);
      color: rgba(229,231,235,.75);
    }
    .cardBtn.revealed .backMark,
    .cardBtn.matched .backMark{ opacity:0; }

    .footerRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .status{
      color:var(--muted);
      font-size:13px;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .badge{
      border:1px solid var(--line);
      border-radius:999px;
      padding:5px 9px;
      font-size:12px;
      background: rgba(11,15,20,.35);
      color: var(--text);
    }
    .badge.ok{ border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.10); }
    .badge.warn{ border-color: rgba(245,158,11,.55); background: rgba(245,158,11,.10); }

    /* Responsive m√≥vil: una columna */
    @media (max-width: 820px){
      .layout{ grid-template-columns: 1fr; }
      .side{ order: 2; }
      .boardArea{ order: 1; }
    }
  </style>
</head>

<body>
<div class="app" id="app">
  <header id="header">
    <div class="title">
      <h1>üß† Memoria (Memory Cards)</h1>
      <small>Encuentra todas las parejas ‚Ä¢ 4√ó4 / 6√ó6 / 8√ó8</small>
      <div class="byline">Por: <b>Soamy Lanza</b></div>
    </div>
  </header>

  <main>
    <section class="panel" id="panel">
      <div class="layout" id="layout">
        <!-- IZQUIERDA -->
        <aside class="side" id="side">
          <div class="cardBox" id="sideBox">
            <div class="controls" id="controls">
              <select id="sizeSel" aria-label="Tama√±o">
                <option value="4" selected>4√ó4</option>
                <option value="6">6√ó6</option>
                <option value="8">8√ó8</option>
              </select>
              <button class="primary" id="newBtn">Nuevo</button>
              <button class="warn" id="restartBtn">Reiniciar</button>
            </div>

            <div class="hint" id="hint" style="margin-top:8px">
              <b>Instrucciones:</b> toca dos cartas para revelar. Si son iguales, se quedan abiertas.
              Si no, se voltean de nuevo. Gana cuando completes todas las parejas.
              <br><br>
              ‚è±Ô∏è El cron√≥metro inicia en tu primera jugada.
            </div>

            <div class="actions" style="margin-top:10px">
              <button id="shareBtn" class="shareBig">Compartir</button>
            </div>
          </div>

          <!-- ‚úÖ m√©tricas abajo a la izquierda -->
          <div class="cardBox">
            <div class="statsLeft">
              <div class="pill">‚è±Ô∏è Tiempo <b id="time">00:00.0</b></div>
              <div class="pill">üÉè Movidas <b id="moves">0</b></div>
              <div class="pill">‚úÖ Parejas <b><span id="pairs">0</span> / <span id="pairsTotal">0</span></b></div>
            </div>
          </div>

          <div class="footerRow">
            <div class="status" id="status">
              <span class="badge warn">En progreso</span>
              <span>Nuevo tablero. ¬°A jugar!</span>
            </div>
          </div>

          <div class="hint" style="opacity:.85">
            Una sola pantalla ‚Ä¢ comparte el link por WhatsApp/redes
          </div>
        </aside>

        <!-- DERECHA -->
        <section class="boardArea" id="boardArea">
          <div class="boardWrap" id="boardWrap">
            <div class="board" id="board" aria-label="Tablero de Memoria"></div>
          </div>
        </section>
      </div>
    </section>
  </main>
</div>

<script>
(() => {
  const root = document.documentElement;

  const appEl = document.getElementById("app");
  const headerEl = document.getElementById("header");
  const panelEl  = document.getElementById("panel");

  const statusEl = document.getElementById("status");
  const boardAreaEl = document.getElementById("boardArea");
  const boardEl = document.getElementById("board");

  const sizeSel = document.getElementById("sizeSel");
  const newBtn = document.getElementById("newBtn");
  const restartBtn = document.getElementById("restartBtn");
  const shareBtn = document.getElementById("shareBtn");

  const timeEl = document.getElementById("time");
  const movesEl = document.getElementById("moves");
  const pairsEl = document.getElementById("pairs");
  const pairsTotalEl = document.getElementById("pairsTotal");

  function num(v){ return Number.parseFloat(v) || 0; }

  // ‚úÖ Fit definitivo: prioriza ALTO disponible para que 8x8 muestre 8 filas completas
  function fitBoard(){
    const N = Number(sizeSel.value);

    const vvH = window.visualViewport ? window.visualViewport.height : window.innerHeight;
    const vvW = window.visualViewport ? window.visualViewport.width  : window.innerWidth;

    const appCS = getComputedStyle(appEl);
    const panelCS = getComputedStyle(panelEl);

    const appPadY = num(appCS.paddingTop) + num(appCS.paddingBottom);
    const appGap  = num(appCS.rowGap || appCS.gap);

    const panelPadY = num(panelCS.paddingTop) + num(panelCS.paddingBottom);

    const headerH = headerEl.getBoundingClientRect().height;

    // Alto total libre para el panel
    const freeH = vvH - appPadY - headerH - appGap;

    // Alto interno del panel (lo que se reparte entre columnas)
    const insideH = Math.max(260, freeH - panelPadY);

    // Ancho disponible del √°rea derecha
    const boardAreaW = boardAreaEl.getBoundingClientRect().width;

    // Ajustes para que quepa completo (m√°s agresivo en 8x8)
    const gap = (N === 8) ? 6 : (N === 6 ? 8 : 10);
    const pad = (N === 8) ? 8 : 12;

    root.style.setProperty("--gap", gap + "px");
    root.style.setProperty("--pad", pad + "px");

    // Safety para evitar que el borde se corte por sombras/antialias
    const safety = (N === 8) ? 22 : (N === 6 ? 18 : 16);

    // üöÄ El tama√±o lo limitamos por: alto interno y ancho del √°rea derecha
    const size = Math.floor(Math.min(insideH, boardAreaW, vvW) - safety);

    root.style.setProperty("--boardSize", Math.max(240, size) + "px");

    // Tipos por N
    const cardFont = (N === 8) ? 20 : (N === 6 ? 25 : 30);
    const backFont = (N === 8) ? 16 : (N === 6 ? 22 : 26);
    const rad = (N === 8) ? 14 : 16;

    root.style.setProperty("--cardFont", cardFont + "px");
    root.style.setProperty("--backFont", backFont + "px");
    root.style.setProperty("--cardRadius", rad + "px");
  }

  // Timer
  let timerId = null, runningTimer = false, startTime = 0, elapsedMs = 0;
  const fmtTime = (ms) => {
    const m = Math.floor(ms/60000);
    const s = Math.floor((ms%60000)/1000);
    const t = Math.floor((ms%1000)/100);
    return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}.${t}`;
  };
  const startTimer = () => {
    if (runningTimer) return;
    runningTimer = true;
    startTime = performance.now() - elapsedMs;
    if (timerId) clearInterval(timerId);
    timerId = setInterval(() => {
      elapsedMs = performance.now() - startTime;
      timeEl.textContent = fmtTime(elapsedMs);
    }, 100);
  };
  const stopTimer = () => { runningTimer = false; if (timerId){ clearInterval(timerId); timerId=null; } };
  const resetTimer = () => { stopTimer(); elapsedMs=0; timeEl.textContent=fmtTime(0); };

  const setStatus = (type, text) => {
    const cls = type === "ok" ? "badge ok" : "badge warn";
    const label = type === "ok" ? "¬°Listo!" : "En progreso";
    statusEl.innerHTML = `<span class="${cls}">${label}</span><span>${text}</span>`;
  };

  // Game
  const EMOJIS = [
    "üçâ","üçã","üçì","üçí","ü•ù","üçá","üçë","üçç","ü••","üçå",
    "üçî","üçï","üåÆ","üçü","üç£","üç©","üç™","üç´","üßÅ","üçø",
    "‚öΩ","üèÄ","üéæ","üéÆ","üé≤","üéØ","üß©","üé∏","üé∫","ü™©",
    "üê∂","üê±","ü¶ä","üêº","üêµ","üê∏","ü¶Å","üêØ","üê∑","üêß",
    "üöó","üöÄ","‚úàÔ∏è","üö≤","üõµ","üõ¥","üö§","üõ∞Ô∏è","üõ∏","üöÅ",
    "üåà","‚≠ê","üåô","‚ö°","üî•","üíé","üß†","üëª","ü§ñ","üëæ"
  ];

  let N = 4, deck = [], first = null, lock = false, moves = 0, pairs = 0, totalPairs = 0;

  const shuffle = (arr) => {
    for (let i=arr.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
    return arr;
  };

  const buildDeck = () => {
    const totalCards = N*N;
    totalPairs = totalCards/2;
    const faces = shuffle([...EMOJIS]).slice(0, totalPairs);
    const cards = [];
    let id = 0;
    for (const f of faces){
      cards.push({ id: id++, face: f, state: "hidden" });
      cards.push({ id: id++, face: f, state: "hidden" });
    }
    deck = shuffle(cards);
  };

  const updateHUD = () => {
    movesEl.textContent = moves;
    pairsEl.textContent = pairs;
    pairsTotalEl.textContent = totalPairs;
  };

  const setBoardGrid = () => {
    boardEl.style.gridTemplateColumns = `repeat(${N}, 1fr)`;
    boardEl.style.gridTemplateRows = `repeat(${N}, 1fr)`;
  };

  const render = () => {
    boardEl.innerHTML = "";
    setBoardGrid();
    fitBoard(); // ‚úÖ clave

    deck.forEach((c, idx) => {
      const btn = document.createElement("button");
      btn.className = "cardBtn";
      btn.type = "button";
      btn.dataset.index = idx;

      const back = document.createElement("div");
      back.className = "backMark";
      back.textContent = "‚ùì";

      const face = document.createElement("div");
      face.className = "face";
      face.textContent = c.face;

      btn.appendChild(back);
      btn.appendChild(face);

      if (c.state === "revealed") btn.classList.add("revealed");
      if (c.state === "matched") btn.classList.add("matched");

      btn.addEventListener("click", () => onFlip(idx));
      boardEl.appendChild(btn);
    });
  };

  const reveal = (i) => deck[i].state = "revealed";
  const hide = (i) => deck[i].state = "hidden";
  const match = (i) => deck[i].state = "matched";

  const onFlip = (i) => {
    if (lock) return;
    if (deck[i].state !== "hidden") return;

    startTimer();
    reveal(i);
    render();

    if (first === null){ first = i; return; }

    moves++;
    const a = first, b = i;

    if (deck[a].face === deck[b].face){
      match(a); match(b);
      pairs++;
      first = null;
      render();
      updateHUD();

      if (pairs === totalPairs){
        stopTimer();
        setStatus("ok", `¬°Ganaste! Tiempo: ${fmtTime(elapsedMs)} ‚Ä¢ Movidas: ${moves}`);
      } else {
        setStatus("warn", "¬°Bien! Sigue buscando parejas.");
      }
      return;
    }

    lock = true;
    updateHUD();
    setStatus("warn", "No coinciden‚Ä¶ intenta otra vez.");

    setTimeout(() => {
      hide(a); hide(b);
      first = null;
      lock = false;
      render();
    }, 650);
  };

  const newGame = () => {
    N = Number(sizeSel.value);
    moves = 0; pairs = 0; first = null; lock = false;
    resetTimer();
    setStatus("warn", "Nuevo tablero. ¬°A jugar!");
    buildDeck();
    updateHUD();
    render();
  };

  const restart = () => {
    moves = 0; pairs = 0; first = null; lock = false;
    resetTimer();
    setStatus("warn", "Reiniciado. ¬°M√°s r√°pido esta vez! üòÑ");
    buildDeck();
    updateHUD();
    render();
  };

  const share = async () => {
    const url = location.href;
    const text = `üß† Juego de Memoria (${N}√ó${N}) ‚Äî Por Soamy Lanza. ¬øMe ganas?`;
    try{
      if (navigator.share){
        await navigator.share({ title: document.title, text, url });
      } else {
        await navigator.clipboard.writeText(url);
        alert("Link copiado ‚úÖ\nP√©galo en WhatsApp o redes.");
      }
    } catch {
      try{
        await navigator.clipboard.writeText(url);
        alert("Link copiado ‚úÖ");
      } catch {
        prompt("Copia este link:", url);
      }
    }
  };

  newBtn.addEventListener("click", newGame);
  restartBtn.addEventListener("click", restart);
  sizeSel.addEventListener("change", newGame);
  shareBtn.addEventListener("click", share);

  const refit = () => fitBoard();
  window.addEventListener("resize", refit);
  window.addEventListener("orientationchange", () => setTimeout(refit, 60));
  if (window.visualViewport){
    visualViewport.addEventListener("resize", refit);
    visualViewport.addEventListener("scroll", refit);
  }

  newGame();
  setTimeout(refit, 80);
  setTimeout(refit, 250);
})();
</script>
</body>
</html>
